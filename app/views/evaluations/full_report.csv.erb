<% #encoding: UTF-8 %>
<%- headers = [t('full_report.number'), t('full_report.name'), t('full_report.theme'), t('full_report.cloud_service'), t('full_report.supplier'), t('full_report.vendor'), t('full_report.server'), I18n.transliterate(t('full_report.appliances')), t('full_report.users'), t('full_report.gb_reserved'), t('full_report.gb_used'), I18n.transliterate(t('full_report.dependant')), I18n.transliterate(t('full_report.depending')),"Capex","Opex", t('full_report.external'), t('full_report.internal'), t('full_report.recovery_time') + t('full_report.needed'), t('full_report.recovery_time') + t('full_report.guaranteed'), t('full_report.level'), t('full_report.impact_revenue'), t('full_report.planned_enhancements'), I18n.transliterate(t('full_report.future_strategy'))] -%> 
<% export = CSV.generate(" ", { headers: headers, write_headers: true, encoding: "ISO-8859-1"}) do |csv| %>  
    <%- @evaluation_results.each do |evaluation_result| -%> 
        <%- row = [evaluation_result.service.code, evaluation_result.cloned_index[1..-1] + I18n.transliterate(evaluation_result.service.name),evaluation_result.evaluation_service.service.themes.map(&:name).join(", "),evaluation_result.cloud_service ? t('commons._yes') : t('commons._no'),evaluation_result.supplier,evaluation_result.distributor,evaluation_result.servers_count,evaluation_result.appliances_count,evaluation_result.users_count,evaluation_result.gb_reserved,evaluation_result.gb_used,evaluation_result.result_dependant_services.size,evaluation_result.result_depending_services.size,format_num(evaluation_result.capex),format_num(evaluation_result.opex),format_num(evaluation_result.hours_extern),format_num(evaluation_result.hours_intern),evaluation_result.recovery_time,evaluation_result.guaranteed_recovery_time,t("evaluation_results.impact_types.type_#{evaluation_result.impact_name}"),format_num(evaluation_result.failure_impact_per_day),evaluation_result.enhancements,evaluation_result.future_strategy] -%>
        <% csv.add_row row %>  
    <%- end -%> 
<% end %> 
<%= export.lstrip.html_safe %> 

<%# <%- headers = [t('full_report.number'), t('full_report.name'), t('full_report.theme'), t('full_report.cloud_service'), t('full_report.supplier'), t('full_report.vendor'), t('full_report.server'), I18n.transliterate(t('full_report.appliances')), t('full_report.users'), t('full_report.gb_reserved'), t('full_report.gb_used'), I18n.transliterate(t('full_report.dependant')), I18n.transliterate(t('full_report.depending')),"Capex","Opex", t('full_report.external'), t('full_report.internal'), t('full_report.recovery_time') + t('full_report.needed'), t('full_report.recovery_time') + t('full_report.guaranteed'), t('full_report.level'), t('full_report.impact_revenue'), t('full_report.planned_enhancements'), I18n.transliterate(t('full_report.future_strategy'))] -%>
<%# <%= CSV.generate_line headers -%>
<%# <%- @evaluation_results.each do |evaluation_result| -%>
    <%# <%- row = [evaluation_result.service.code, evaluation_result.cloned_index + I18n.transliterate(evaluation_result.service.name),evaluation_result.evaluation_service.service.themes.map(&:name).join(", "),evaluation_result.cloud_service ? t('commons._yes') : t('commons._no'),evaluation_result.supplier,evaluation_result.distributor,evaluation_result.servers_count,evaluation_result.appliances_count,evaluation_result.users_count,evaluation_result.gb_reserved,evaluation_result.gb_used,evaluation_result.result_dependant_services.size,evaluation_result.result_depending_services.size,format_num(evaluation_result.capex),format_num(evaluation_result.opex),format_num(evaluation_result.hours_extern),format_num(evaluation_result.hours_intern),evaluation_result.recovery_time,evaluation_result.guaranteed_recovery_time,t("evaluation_results.impact_types.type_#{evaluation_result.impact_name}"),format_num(evaluation_result.failure_impact_per_day),evaluation_result.enhancements,evaluation_result.future_strategy] -%>
    <%# <%=raw CSV.generate_line row -%>
<%# <%- end -%>